# 重庆邮电大学数学建模竞赛题目B
> [!NOTE]
> @lulaide
## 环境准备
```bash
pip install -r requirements.txt
```
```bash
pip install -r requirements.txt -i https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple
```
## 问题一
### 1.问题描述
根据给出的参考数据（来源于上市公司公布的财务数据），构建一个全面而灵活的财务评价优化模型，以支持研发企业在投资或收购决策过程中做出科学和合理的选择。该模型应包括设计项目总投资公式，全面考虑研发、财务、债务、运营等因素（也可根据模型自主选取），并设计收益率指标公式，计算主要指标波动等影响因素。之后对财务效益进行多因素敏感性模拟分析，以量化各个因素对项目财务效益的影响程度，从中识别出对项目收益影响最大的关键因素和潜在风险。最后，根据敏感性分析结果，提出优化策略，如调整研发投入的阶段性、优化资源配置和制定灵活市场响应机制，以最大化项目的预期收益并有效控制相关风险。

---
## 问题二
### 1.问题描述
请构建一个多维度的**企业价值评估模型**，使得不同企业的信息输入后，生成相应的**综合价值评分**。通过该评估模型，投资者可以对各个企业进行**评分和排序**，从而为投资决策提供有力支持。
### 2.估值方法
#### 折现现金流量法(DCF Analysis)
这里代码中 FCF 的预估方法为：

$$
\mathrm{FCF} = \mathrm{NETCASH\_OPERATE} - \mathrm{CONSTRUCT\_LONG\_ASSET}
$$

DCF 的核心估值公式为：

$$
\mathrm{Valuation}
= \sum_{t=1}^{n} \frac{\mathrm{FCF}_{t}}{(1 + r)^{t}}
+ \frac{\mathrm{FCF}_{n}\,(1 + g_{\infty})}{(r - g_{\infty})\,(1 + r)^{n}}
$$
其中，r 为加权平均资本成本（WACC），$g_{\infty}$ 为永续增长率。

以下是相应的代码示例（摘自 DCF.py）：
```python
def calc_dcf(fcfs, wacc, g_perp):
    # 对预测期内各期 FCF 进行贴现求和
    pv = sum(cf / (1 + wacc) ** (i + 1) for i, cf in enumerate(fcfs))
    # 计算终值 (Terminal Value)
    tv = fcfs[-1] * (1 + g_perp) / (wacc - g_perp)
    pv_terminal = tv / (1 + wacc) ** len(fcfs)
    return pv + pv_terminal
```
以下是示例输出（摘自 DCF.py）：
```bash
sz000598 | EV=-38,322,284,987元 | 净债务=24,554,330,613元 | 股权价值=-62,876,615,601元 | 市值=21,428,241,297元 | 比率=-2.93
------------------------------------------------------------
sz000605 | EV=-1,127,073,243元 | 净债务=4,829,130,451元 | 股权价值=-5,956,203,694元 | 市值=2,673,152,188元 | 比率=-2.23
------------------------------------------------------------
sz000685 | EV=-17,787,771,376元 | 净债务=15,591,827,097元 | 股权价值=-33,379,598,473元 | 市值=12,730,210,959元 | 比率=-2.62
------------------------------------------------------------
sz003039 | EV=-2,805,139,606元 | 净债务=2,972,818,215元 | 股权价值=-5,777,957,821元 | 市值=8,669,962,969元 | 比率=-0.67
------------------------------------------------------------
sh600008 | EV=-24,774,431,800元 | 净债务=66,553,670,125元 | 股权价值=-91,328,101,925元 | 市值=23,049,454,726元 | 比率=-3.96
------------------------------------------------------------
sh600168 | EV=-17,225,596,757元 | 净债务=17,172,522,238元 | 股权价值=-34,398,118,995元 | 市值=4,619,298,696元 | 比率=-7.45
------------------------------------------------------------
sh600187 | EV=-1,717,496,735元 | 净债务=-42,743,490元 | 股权价值=-1,674,753,245元 | 市值=5,147,961,719元 | 比率=-0.33
------------------------------------------------------------
sh600283 | EV=-3,709,664,370元 | 净债务=4,746,019,644元 | 股权价值=-8,455,684,014元 | 市值=5,978,393,413元 | 比率=-1.41
------------------------------------------------------------
sh600461 | EV=-6,167,809,826元 | 净债务=11,416,024,021元 | 股权价值=-17,583,833,847元 | 市值=12,379,254,113元 | 比率=-1.42
------------------------------------------------------------
sh600769 | EV=410,690,891元 | 净债务=109,198,728元 | 股权价值=301,492,163元 | 市值=4,061,003,076元 | 比率=0.07
------------------------------------------------------------
sh601158 | EV=-8,422,250,548元 | 净债务=17,035,285,191元 | 股权价值=-25,457,535,739元 | 市值=23,616,000,000元 | 比率=-1.08
------------------------------------------------------------
sh601199 | EV=-1,522,201,446元 | 净债务=1,573,245,734元 | 股权价值=-3,095,447,180元 | 市值=5,078,191,886元 | 比率=-0.61
------------------------------------------------------------
sh601368 | EV=-22,830,438,751元 | 净债务=18,016,650,942元 | 股权价值=-40,847,089,692元 | 市值=4,600,289,731元 | 比率=-8.88
------------------------------------------------------------
sh603291 | EV=-1,634,723,152元 | 净债务=1,775,682,786元 | 股权价值=-3,410,405,937元 | 市值=5,379,133,877元 | 比率=-0.63
------------------------------------------------------------
sh603759 | EV=-1,200,483,402元 | 净债务=3,619,316,137元 | 股权价值=-4,819,799,539元 | 市值=3,721,785,600元 | 比率=-1.30
```
#### 席勒市盈率法(CAPE)
在 `CAPE.py` 中，流程如下：

1. 从利润表中提取 `BASIC\_EPS`，按年度分组并计算近 10 年的 EPS 均值：

   $$
   \mathrm{EPS}_{10\mathrm{y}}
   = \frac{1}{10} \sum_{i=1}^{10} \mathrm{EPS}_{i}
   $$

2. 获取股票最新的收盘价：

   $$
   \mathrm{Close}
   $$

3. 计算席勒市盈率（CAPE）：

   $$
   \mathrm{CAPE}
   = \frac{\mathrm{Close}}{\mathrm{EPS}_{10\mathrm{y}}}
   $$
以下是核心代码示例：
```python
# 转换 REPORT_DATE 为 datetime, 排序, 并提取年度 EPS 均值
df_inc["REPORT_DATE"] = pd.to_datetime(df_inc["REPORT_DATE"])
df_inc = df_inc.sort_values("REPORT_DATE")
df_inc["year"] = df_inc["REPORT_DATE"].dt.year
eps_yearly = df_inc.groupby("year")["BASIC_EPS"].mean()
eps_10y = eps_yearly.tail(10)
avg_eps_10y = eps_10y.mean()

# 获取每日历史行情的最新收盘价
df_price = pd.read_csv(daily_path, encoding="utf-8", parse_dates=["date"])
latest_close = df_price.sort_values("date").iloc[-1]["close"]

# 计算 CAPE
cape = latest_close / avg_eps_10y if avg_eps_10y != 0 else float("nan")
```
以下是示例输出（摘自 CAPE.py）：
```bash
       stock  最新收盘价   十年平均EPS  席勒市盈率(CAPE)
0   sz000685   8.82  0.440750    20.011344
1   sh600168   4.63  0.211250    21.917160
2   sh600461   9.59  0.431750    22.211928
3   sh600008   3.18  0.135680    23.437500
4   sh601158   4.92  0.199500    24.661654
5   sz000598   7.21  0.276040    26.119403
6   sh601368   4.92  0.165615    29.707454
7   sh601199   5.38  0.172035    31.272706
8   sh603759   8.02  0.244908    32.747058
9   sz003039  13.82  0.234194    59.010863
10  sh600283  10.74  0.175500    61.196581
11  sh603291  12.73  0.154144    82.585182
12  sz000605   7.58  0.076332    99.302394
13  sh600769  10.67  0.012500   853.600000
14  sh600187   3.20  0.001070  2990.654206
```

---
## 问题三
### 1.问题描述
针对不同类型的投资项目（如新建、扩建、改建等），构建一个动态风险评估模型，以量化各类风险（如市场风险、技术风险、政策风险等），识别项目面临的各种风险因素，并评估整体风险水平及各因素的影响程度，从而为项目风险管理提供有力支持。

---

## 参考资料
- [什么是估值？其运作方式及方法](https://www.investopedia.com/terms/v/valuation.asp)
- [估值概述](https://corporatefinanceinstitute.com/resources/valuation/valuation/)
- [现金流 DCF 公式](https://corporatefinanceinstitute.com/resources/valuation/dcf-formula-guide/)